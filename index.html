<!doctype html>
<html lang="hu">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>ZSzJS Vonat Zrt. - Jegyvásárlás</title>
        <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
        <link rel="stylesheet" href="css/sztalj.css" />
    </head>
    <body>
        <header>
            <div class="container">
                <h1>ZSzJS Vonat Zrt.</h1>
                <nav>
                    <ul>
                        <li><a href="index.html">Főoldal</a></li>
                        <li><a href="timetable.html">Menetrend</a></li>
                        <li><a href="#">Információk</a></li>
                        <li><a href="kapcsolat.html">Kapcsolat</a></li>
                    </ul>
                </nav>
            </div>
        </header>

        <main>
            <section class="hero">
                <div class="container">
                    <h2>Üdvözöljük a ZSzJS Vonat Zrt. honlapján!</h2>
                    <p>Gyorsan és kényelmesen vásároljon jegyet online.</p>
                </div>
            </section>

            <section class="ticket-form">
                <div class="container">
                    <h2>Jegyvásárlás</h2>
                    <form id="ticketForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="utas_nev">Utas neve:</label>
                                <input
                                    type="text"
                                    id="utas_nev"
                                    name="utas_nev"
                                    required
                                />
                            </div>

                            <div class="form-group">
                                <label for="email">Email cím:</label>
                                <input
                                    type="email"
                                    id="email"
                                    name="email"
                                    required
                                />
                            </div>

                            <div class="form-group">
                                <label for="tel_szam">Telefonszám:</label>
                                <input
                                    type="tel"
                                    id="tel_szam"
                                    name="tel_szam"
                                    required
                                />
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="departure">Honnan:</label>
                                <select id="departure" name="honnan" required>
                                    <option value="" disabled selected>
                                        Válasszon indulási helyet
                                    </option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="arrival">Hova:</label>
                                <select id="arrival" name="hova" required>
                                    <option value="" disabled selected>
                                        Válasszon célállomást
                                    </option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="date">Utazás dátuma:</label>
                                <input
                                    type="date"
                                    id="date"
                                    name="date"
                                    required
                                />
                            </div>

                            <div class="form-group">
                                <label for="time">Időpont:</label>
                                <select id="time" name="time" required>
                                    <option value="">
                                        Válasszon időpontot
                                    </option>
                                    <option value="06:00:00">
                                        Reggel (6:00 - 12:00)
                                    </option>
                                    <option value="12:00:00">
                                        Délután (12:00 - 18:00)
                                    </option>
                                    <option value="18:00:00">
                                        Este (18:00 - 24:00)
                                    </option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="felnott_szam"
                                    >Felnőttek száma:</label
                                >
                                <input
                                    type="number"
                                    id="felnott_szam"
                                    name="felnott_szam"
                                    min="1"
                                    max="10"
                                    value="1"
                                    required
                                />
                            </div>

                            <div class="form-group">
                                <label for="gyerek_szam">Gyerekek száma:</label>
                                <input
                                    type="number"
                                    id="gyerek_szam"
                                    name="gyerek_szam"
                                    min="0"
                                    max="10"
                                    value="0"
                                />
                            </div>

                            <div class="form-group">
                                <label for="osztaly">Osztály:</label>
                                <select id="osztaly" name="osztaly" required>
                                    <option value="2">Másodosztály</option>
                                    <option value="1">Első osztály</option>
                                </select>
                            </div>
                        </div>

                        <button type="submit" class="btn">
                            Jegy vásárlása
                        </button>
                    </form>
                </div>
            </section>
        </main>

        <footer>
            <div class="container">
                <p>&copy; 2023 ZSzJS Vonat Zrt. Minden jog fenntartva.</p>
                <p>Telefon: +36 1 234 5678 | Email: info@zszjsvonat.hu</p>
            </div>
        </footer>

        <script>
            const supabaseUrl = "https://tsizknpqvzvhsfwpatgc.supabase.co";
            const supabaseKey =
                "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRzaXprbnBxdnp2aHNmd3BhdGdjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEyMTg3NDUsImV4cCI6MjA4Njc5NDc0NX0.ojcpA7XKkTkNeOCpmcNKUFspmmOB9wGPEf8fxAl9Pig";

            const db = window.supabase.createClient(supabaseUrl, supabaseKey);

            async function loadStations() {
                const { data, error } = await db.from("stations").select("*");
                if (data) {
                    const departureSelect =
                        document.getElementById("departure");
                    const arrivalSelect = document.getElementById("arrival");
                    data.forEach((station) => {
                        const stationId =
                            station.id ||
                            station.station_id ||
                            station[
                                Object.keys(station).find((k) =>
                                    k.includes("id"),
                                )
                            ];
                        const stationName =
                            station.name ||
                            station.nev ||
                            station[
                                Object.keys(station).find(
                                    (k) =>
                                        typeof station[k] === "string" &&
                                        !k.includes("id"),
                                )
                            ];
                        const option = `<option value="${stationId}">${stationName}</option>`;
                        departureSelect.insertAdjacentHTML("beforeend", option);
                        arrivalSelect.insertAdjacentHTML("beforeend", option);
                    });
                }
            }

            document
                .getElementById("ticketForm")
                .addEventListener("submit", async (e) => {
                    e.preventDefault();

                    const date = document.getElementById("date").value;
                    const time = document.getElementById("time").value;
                    const indulas_datum = `${date}T${time}`;

                    const ticketData = {
                        utas_nev: document.getElementById("utas_nev").value,
                        email: document.getElementById("email").value,
                        tel_szam: parseInt(
                            document.getElementById("tel_szam").value,
                        ),
                        honnan: parseInt(
                            document.getElementById("departure").value,
                        ),
                        hova: parseInt(
                            document.getElementById("arrival").value,
                        ),
                        indulas_datum: indulas_datum,
                        felnott_szam: parseInt(
                            document.getElementById("felnott_szam").value,
                        ),
                        gyerek_szam: parseInt(
                            document.getElementById("gyerek_szam").value,
                        ),
                        osztaly: parseInt(document.getElementById("osztaly").value),
                    };

                    const { error } = await db
                        .from("tickets")
                        .insert(ticketData);

                    if (error) {
                        alert("Hiba: " + error.message);
                    } else {
                        alert("Sikeres jegyvásárlás!");
                        document.getElementById("ticketForm").reset();
                    }
                });

            loadStations();
        </script>
    </body>
</html>
